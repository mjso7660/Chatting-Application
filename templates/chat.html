<!------ Include the above in your HEAD tag ---------->


<html>
<head>

<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/chat.css') }}">
<link rel="shortcut icon" href="">
</head>
<body>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>
    <script type="text/javascript">
	  function log_out(){
		socket.emit('logout',{data: ''})
	  }
      var socket = io.connect('http://' + document.domain + ':' + location.port);
      socket.on( 'connect', function() {
        socket.emit( 'boot', {
          data: 0
        } )
		socket.emit( 'test', {
          data: 0
        } )
        var form = $( 'form.chat' ).on( 'submit', function( e ) {
          e.preventDefault()
          let user_input = $( 'input.write_msg' ).val()
          socket.emit( 'my event', {
            message : user_input
          } )
          $( 'input.message' ).val( '' ).focus()
			this.reset();
			console.log(user_input)
        } )

		var form = $( 'form.search' ).on( 'submit', function( e ) {
          e.preventDefault()
          let user_input = $( 'input.search-bar' ).val()
          $('.incoming_msg').remove();
          $('.outgoing_msg').remove();
          socket.emit( 'search', {
            message : user_input
          } )
          $( 'input.message' ).val( '' ).focus()
			this.reset();
			console.log(user_input);
        } )
      } )
	  socket.on('message_history',function(his){
	    //console.log(his);
		console.log(his[0]);
		len = Object(his).length
		for(var k = len-1; k >=0; k--){
		  if(his[k]['sender']=='me'){
			$( 'div.msg_history').append('<div class="outgoing_msg"><div class="sent_msg"><p>'+his[k]['message']+'</p><span class="time_date"> </span> </div></div>')
		  }else{
		    $( 'div.msg_history').append('<div class="incoming_msg"><div class="incoming_msg_img"> <img src="http://2014.igem.org/wiki/images/f/fe/Cooper-Union.png" alt="sunil"> </div> <div class="received_msg"><div class="received_withd_msg"> <p>'+his[k]['message']+'</p><span class="time_date"> </span></div></div></div>') 
		  }
		}
	  })
	  socket.on('update_list',function(msg){
		len = Object(msg).length;
		console.log(msg)
		for(var i = 0; i < len; i++){
			$('div.inbox_chat').append('<div class="chat_list active_chat" onclick=test('+i+')><div class="chat_people"><div class="chat_img"> <img src="http://2014.igem.org/wiki/images/f/fe/Cooper-Union.png"></div><div class="chat_ib"><h5>'+msg[i]['users']+'<span class="chat_date">'+msg[i]['date']+'</span></h5><p>'+msg[i]['message']+'</p></div></div></div>')
		}
	  })
      socket.on( 'my response', function( msg ) {
	if((typeof msg.message!=='undefined') && msg.message.replace(/^\s+|\s+$/g,'') != ''){
          var dt = new Date()
	        $( 'div.msg_history').append('<div class="outgoing_msg"><div class="sent_msg"><p>'+msg.message+'</p><span class="time_date"> </span> </div></div>')
	}
      })
	  
	  function test(i){
		var tabs = document.querySelectorAll('.chat_list');
		for(var j = 0; j < tabs.length; j++){
			if(j == i){
				document.querySelectorAll('.chat_list')[j].className="chat_list active_chat";
				var name = document.querySelectorAll('.chat_ib > h5')[j].innerHTML.split("<")[0];
			}else{
				document.querySelectorAll('.chat_list')[j].className="chat_list";
			}	
		}
		$('.incoming_msg').remove();
		$('.outgoing_msg').remove();
		socket.emit('test',{
			data: i
		})
	  }
	  
	  
    </script>

<div class="container">
<h3 class=" text-center">Messaging</h3>
<div class="messaging">
      <div class="inbox_msg">
        <div class="inbox_people">
          <div class="headind_srch">
            <div class="recent_heading">
              <h4>Recent</h4>
            </div>
            <div class="srch_bar">
              <div class="stylish-input-group">
				<form action="" method="POST" class="search">
					<input type="text" class="search-bar"  placeholder="Search" >
					<span class="input-group-addon">
					<button type="button"> <i class="fa fa-search" aria-hidden="true"></i> </button>
					</span>
				</form>
			  </div>
            </div>
          </div>
          <div class="inbox_chat">
			
			<!--				INBOX CHAT COMES HERE				 -->
<!--			
		   <div class="chat_list active_chat" onclick=test(0)>
              <div class="chat_people">
                <div class="chat_img"> <img src="http://2014.igem.org/wiki/images/f/fe/Cooper-Union.png"></div>
                <div class="chat_ib">
                  <h5>MediCooper<span class="chat_date">Oct 21</span></h5>
					<p>How can I help you today?</p>
                </div>
              </div>
            </div>
            <div class="chat_list" onclick=test(1)>
              <div class="chat_people">
                <div class="chat_img"> <img src="https://amp.businessinsider.com/images/5899ffcf6e09a897008b5c04-750-750.jpg"></div>
                <div class="chat_ib">
                  <h5>Dr. Park<span class="chat_date">Oct 20</span></h5>
                  <p>Turner syndrome can cause a variety of medical and developmental problems, including short height, failure of the ovaries to develop and heart defects.</p>
                    
                </div>
              </div>
            </div>
            <div class="chat_list" onclick=test(2)>
              <div class="chat_people">
                <div class="chat_img"> <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTTyWlY1SRu2M653bjl0x_cgk_NY4xidK9xalcVjaOa6L0F1ttfcA"></div>
                <div class="chat_ib">
                  <h5>Brittle Bone Disease Community<span class="chat_date">Oct 19</span></h5>
		  <p>Turner syndrome may be diagnosed before birth (prenatally), during infancy or in early childhood. </p>
                </div>
              </div>
            </div>
            <div class="chat_list" onclick=test(3)>
              <div class="chat_people">
                <div class="chat_img"> <img src="https://i.stack.imgur.com/rYsym.png"></div>
                <div class="chat_ib">
                  <h5>Anonymous Blue<span class="chat_date">Oct 18</span></h5>
		  <p>Clinical signs may vary from person to person (clinical heterogeneity), even within families.</p>
                </div>
              </div>
            </div>
            <div class="chat_list"onclick=test(4)>
              <div class="chat_people">
                <div class="chat_img"> <img src="https://avatars1.githubusercontent.com/u/540587?s=88&v=4"></div>
                <div class="chat_ib">
                  <h5>Anonymous Green<span class="chat_date">Oct 18</span></h5>
		  <p>Turner syndrome, a condition that affects only females, results when one of the X chromosomes (sex chromosomes) is missing or partially missing. </p>
                </div>
              </div>
            </div>
            <div class="chat_list" onclick=test(5)>
              <div class="chat_people">
                <div class="chat_img"> <img src="https://avatars3.githubusercontent.com/u/9485711?s=88&v=4" alt="sunil"> </div>
                <div class="chat_ib">
                  <h5>Anonymous Purple <span class="chat_date">Oct 17</span></h5>
                  <p>Test, which is a new approach to have all solutions 
                    astrology under one roof.</p>
                </div>
              </div>
            </div>
            <div class="chat_list">
              <div class="chat_people">
                <div class="chat_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil"> </div>
                <div class="chat_ib">
                  <h5>Sunil Rajput <span class="chat_date">Oct 16</span></h5>
                  <p>Test, which is a new approach to have all solutions 
                    astrology under one roof.</p>
                </div>
              </div>
            </div>
		  -->
          
		  </div>
        </div>
		<div class="mesgs"> 
          <div class="msg_history"> 
		  
		  <!--				MSG COMES HERE				 -->		  
			<div class="incoming_msg"> 
              <div class="received_msg"> 
                <div class="received_withd_msg"> 
				 </div> 
             </div> 
          </div> 
		  <div class="message_holder"> 
		  </div> 
        </div> 
        <div class="type_msg"> 
            <div class="input_msg_write"> 
			  <form action="" method="POST" class="chat">
				  <input type="text" class="write_msg" placeholder="Type a message" /> 
				  <div class="msg_send_btn">
						  <input type="submit" class="msg_send_btn"></div>
			  </form>
            </div> 
        </div> 
      </div> 
</div> 

      
      
      <button type="button" method=post onclick="log_out()">Log Out</button>
      
    </div></div>

    </body>
    </html>
