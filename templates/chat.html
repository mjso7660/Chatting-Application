<!------ Include the above in your HEAD tag ---------->


<html>
<head>

<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/chat.css') }}">
<link rel="shortcut icon" href="">
</head>
<body>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>
    <script type="text/javascript">
      var socket = io.connect('http://' + document.domain + ':' + location.port);
      socket.on( 'connect', function() {
        socket.emit( 'test', {
          data: 'User Connected'
        } )
        var form = $( 'form.chat' ).on( 'submit', function( e ) {
          e.preventDefault()
          let user_input = $( 'input.write_msg' ).val()
          socket.emit( 'my event', {
            message : user_input
          } )
          $( 'input.message' ).val( '' ).focus()
			this.reset();
			console.log(user_input)
        } )
		var form = $( 'form.search' ).on( 'submit', function( e ) {
          e.preventDefault()
          let user_input = $( 'input.search-bar' ).val()
          socket.emit( 'search', {
            message : user_input
          } )
          $( 'input.message' ).val( '' ).focus()
			this.reset();
			console.log(user_input);
        } )
		
		
      } )
	  socket.on('message_history',function(his){
	    len = Object.keys(his).length
	    console.log(Object.keys(his).length);
		for(var k = 0; k < len; k++){
		  if(k%2){
			$( 'div.msg_history').append('<div class="outgoing_msg"><div class="sent_msg"><p>'+his[k]+'</p><span class="time_date"> </span> </div></div>')
		  }else{
		    $( 'div.msg_history').append('<div class="outgoing_msg"><div class="sent_msg"><p>'+his[k]+'</p><span class="time_date"> </span> </div></div>')
		  }
		}
	  })
      socket.on( 'my response', function( msg ) {
	if(typeof msg.message!=='undefined'){
          var dt = new Date()
	        $( 'div.msg_history').append('<div class="outgoing_msg"><div class="sent_msg"><p>'+msg.message+'</p><span class="time_date"> </span> </div></div>')
	}
      })
      socket.on( 'your response', function( msg ) {
	if(typeof msg.message!=='undefined'){
	        //$( 'div.msg_history').append('<div class="outgoing_msg"><div class="incoming_msg_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil"> </div><div class="received_msg"><div class="received_withd_msg"><p>'+msg.message+'</p><span class="time_date"> </span> </div></div></div>')
			$( 'div.msg_history').append('<div class="outgoing_msg"><div class="sent_msg"><p>'+msg.message+'</p><span class="time_date"> </span> </div></div>')
	}
      })
	  
	  function test(i){
		var tabs = document.querySelectorAll('.chat_list');
		for(var j = 0; j < tabs.length; j++){
			if(j == i){
				document.querySelectorAll('.chat_list')[j].className="chat_list active_chat";
				var name = document.querySelectorAll('.chat_ib > h5')[j].innerHTML.split("<")[0];
			}else{
				document.querySelectorAll('.chat_list')[j].className="chat_list";
			}	
		}
		$('.incoming_msg').remove();
		$('.received_msg').remove();
		socket.emit('get_message',{
			uname: name
		})
	  }
    </script>

<div class="container">
<h3 class=" text-center">Messaging</h3>
<div class="messaging">
      <div class="inbox_msg">
        <div class="inbox_people">
          <div class="headind_srch">
            <div class="recent_heading">
              <h4>Recent</h4>
            </div>
            <div class="srch_bar">
              <div class="stylish-input-group">
				<form action="" method="POST" class="search">
					<input type="text" class="search-bar"  placeholder="Search" >
					<span class="input-group-addon">
					<button type="button"> <i class="fa fa-search" aria-hidden="true"></i> </button>
					</span>
				</form>
			  </div>
            </div>
          </div>
          <div class="inbox_chat">
		  
		  <!--				INBOX CHAT COMES HERE				 -->
          
		  </div>
        </div>
		<div class="mesgs"> 
          <div class="msg_history"> 
		  
		  <!--				MSG COMES HERE				 -->		  
			<div class="incoming_msg"> 
              <div class="received_msg"> 
                <div class="received_withd_msg"> 
				 </div> 
             </div> 
          </div> 
		  <div class="message_holder"> 
		  </div> 
        </div> 
        <div class="type_msg"> 
            <div class="input_msg_write"> 
			  <form action="" method="POST" class="chat">
				  <input type="text" class="write_msg" placeholder="Type a message" /> 
				  <div class="msg_send_btn">
						  <input type="submit" class="msg_send_btn"></div>
			  </form>
            </div> 
        </div> 
      </div> 
</div> 

      
      
      <p class="text-center top_spac"> Design by <a target="_blank" href="#">Sunil Rajput</a></p>
      
    </div></div>

    </body>
    </html>
